<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rutinkoo — Premium Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --card-bg: #1c1c1e;
            --input-bg: #2c2c2e;
            --text-main: #ffffff;
            --text-dim: #8e8e93;
            --accent: #ffffff;
            
            /* Grade Colors */
            --color-aplus: #4cd964;
            --color-a: #34c759;
            --color-b: #8bc34a;
            --color-c: #ffcc00;
            --color-d: #ff9500;
            --color-f: #ff3b30;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-font-smoothing: antialiased;
        }

        /* --- TOP NAV --- */
        .year-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            padding: 20px 0;
            width: 100%;
            font-size: 1.2rem;
            font-weight: 600;
        }
        .nav-arrow {
            cursor: pointer;
            color: var(--text-dim);
            text-decoration: none;
            font-size: 1.5rem;
        }

        .container {
            width: 100%;
            max-width: 450px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- TODAY CARD --- */
        .card {
            background: var(--card-bg);
            border-radius: 18px;
            padding: 20px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-header h2 { margin: 0; font-size: 1.1rem; }
        .card-header span { color: var(--text-dim); font-size: 0.9rem; }

        .grade-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .grade-circle {
            width: 45px;
            height: 38px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            background: #2c2c2e;
            color: var(--text-dim);
            opacity: 0.4;
            transition: 0.2s;
        }
        .grade-circle.active { opacity: 1; color: #000; }

        .note-area {
            background: var(--input-bg);
            border-radius: 12px;
            padding: 15px;
            width: 100%;
            border: none;
            color: var(--text-main);
            font-family: inherit;
            resize: none;
            min-height: 80px;
            outline: none;
        }

        /* --- TOGGLE --- */
        .view-toggle {
            display: flex;
            background: var(--card-bg);
            border-radius: 10px;
            padding: 4px;
            width: fit-content;
            align-self: center;
        }

        .toggle-btn {
            padding: 8px 25px;
            border-radius: 8px;
            border: none;
            background: transparent;
            color: var(--text-dim);
            font-weight: 500;
            cursor: pointer;
        }
        .toggle-btn.active {
            background: var(--input-bg);
            color: var(--text-main);
        }

        /* --- CALENDAR --- */
        .calendar-title {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .day-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .weekday {
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-dim);
            padding-bottom: 10px;
        }

        .day-box {
            aspect-ratio: 1;
            background: var(--input-bg);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            cursor: pointer;
            position: relative;
        }

        .day-box.current { border: 2px solid #fff; }
        .day-box.future { color: var(--text-dim); opacity: 0.5; }

        .day-dot {
            width: 3px;
            height: 3px;
            background: var(--text-dim);
            border-radius: 50%;
            position: absolute;
            bottom: 6px;
        }

        /* --- HABIT MANAGER --- */
        .habit-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        .habit-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--input-bg);
            padding: 12px;
            border-radius: 10px;
        }
        .checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--color-a);
        }

        .delete-icon { color: var(--color-f); cursor: pointer; font-weight: bold; }

    </style>
</head>
<body>

    <div class="year-nav">
        <span class="nav-arrow" onclick="changeYear(-1)">‹</span>
        <span id="display-year">2026</span>
        <span class="nav-arrow" onclick="changeYear(1)">›</span>
    </div>

    <div class="container">
        
        <!-- Today Section -->
        <div class="card">
            <div class="card-header">
                <h2>Today</h2>
                <span id="display-full-date">Wednesday, Jan 14</span>
            </div>
            
            <div class="grade-row" id="grade-row">
                <div class="grade-circle" id="g-aplus" style="background: var(--color-aplus);">A+</div>
                <div class="grade-circle" id="g-a" style="background: var(--color-a);">A</div>
                <div class="grade-circle" id="g-b" style="background: var(--color-b);">B</div>
                <div class="grade-circle" id="g-c" style="background: var(--color-c);">C</div>
                <div class="grade-circle" id="g-d" style="background: var(--color-d);">D</div>
                <div class="grade-circle" id="g-f" style="background: var(--color-f);">F</div>
            </div>

            <textarea class="note-area" id="note-input" placeholder="Add a note about your day..." oninput="updateNote(this.value)"></textarea>
            
            <div class="habit-list" id="habit-checklist">
                <!-- Habits for today show here -->
            </div>
            
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <input type="text" id="new-habit" placeholder="New Goal..." style="flex:1; background: var(--input-bg); border:none; padding:10px; border-radius:8px; color:#fff;">
                <button onclick="addHabit()" style="background: #fff; border:none; border-radius:8px; padding:0 15px; font-weight:600;">Add</button>
            </div>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
            <button class="toggle-btn active">Month</button>
            <button class="toggle-btn" onclick="alert('Analytics page is being upgraded to match this style!')">Year</button>
        </div>

        <!-- Calendar Section -->
        <div class="card">
            <div class="calendar-title">
                <span class="nav-arrow" onclick="changeMonth(-1)">‹</span>
                <span id="calendar-month-year">January 2026</span>
                <span class="nav-arrow" onclick="changeMonth(1)">›</span>
            </div>
            
            <div class="day-grid" id="weekday-headers">
                <div class="weekday">MON</div><div class="weekday">TUE</div><div class="weekday">WED</div>
                <div class="weekday">THU</div><div class="weekday">FRI</div><div class="weekday">SAT</div>
                <div class="weekday">SUN</div>
            </div>
            
            <div class="day-grid" id="calendar-grid">
                <!-- Grid Days Generated by JS -->
            </div>
        </div>
    </div>

    <script>
        let habits = JSON.parse(localStorage.getItem('rutinkoo_habits')) || ['Exercise', 'Reading'];
        let trackerData = JSON.parse(localStorage.getItem('rutinkoo_data')) || {};
        let viewDate = new Date(); // The date currently being viewed/edited
        let calendarDate = new Date(); // The month shown in the calendar

        function saveData() {
            localStorage.setItem('rutinkoo_habits', JSON.stringify(habits));
            localStorage.setItem('rutinkoo_data', JSON.stringify(trackerData));
        }

        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // --- CALENDAR LOGIC ---
        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            
            const month = calendarDate.getMonth();
            const year = calendarDate.getFullYear();
            
            document.getElementById('calendar-month-year').textContent = 
                calendarDate.toLocaleString('default', { month: 'long', year: 'numeric' });
            document.getElementById('display-year').textContent = year;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Adjust for Monday start
            let startPadding = firstDay === 0 ? 6 : firstDay - 1;

            // Empty boxes for padding
            for (let i = 0; i < startPadding; i++) {
                grid.appendChild(document.createElement('div'));
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dk = formatDateKey(date);
                const box = document.createElement('div');
                box.className = 'day-box';
                box.textContent = day;

                // Coloring based on completion
                const score = calculateDayScore(dk);
                if (score !== null) {
                    box.style.background = getGradeColor(score);
                    box.style.color = '#000';
                    box.style.fontWeight = '700';
                }

                if (dk === formatDateKey(new Date())) box.classList.add('current');
                if (date > new Date()) box.classList.add('future');

                // Check if has notes
                if (trackerData[dk]?.note) {
                    const dot = document.createElement('div');
                    dot.className = 'day-dot';
                    box.appendChild(dot);
                }

                box.onclick = () => {
                    viewDate = new Date(date);
                    renderDayView();
                };
                grid.appendChild(box);
            }
        }

        function calculateDayScore(dk) {
            if (!trackerData[dk]) return null;
            const dayHabits = habits.filter(h => trackerData[dk][h] === true);
            if (habits.length === 0) return null;
            return (dayHabits.length / habits.length) * 100;
        }

        function getGradeColor(percent) {
            if (percent >= 100) return 'var(--color-aplus)';
            if (percent >= 80) return 'var(--color-a)';
            if (percent >= 60) return 'var(--color-b)';
            if (percent >= 40) return 'var(--color-c)';
            if (percent >= 20) return 'var(--color-d)';
            return 'var(--color-f)';
        }

        // --- DAY VIEW LOGIC ---
        function renderDayView() {
            const dk = formatDateKey(viewDate);
            document.getElementById('display-full-date').textContent = 
                viewDate.toLocaleDateString(undefined, { weekday: 'long', month: 'short', day: 'numeric' });
            
            // Note
            document.getElementById('note-input').value = trackerData[dk]?.note || '';

            // Habits
            const list = document.getElementById('habit-checklist');
            list.innerHTML = '';
            habits.forEach(h => {
                const item = document.createElement('div');
                item.className = 'habit-item';
                const isChecked = trackerData[dk]?.[h] ? 'checked' : '';
                item.innerHTML = `
                    <span>${h}</span>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="checkbox" class="checkbox" ${isChecked} onchange="toggleHabit('${dk}', '${h}')">
                        <span class="delete-icon" onclick="removeHabit('${h}')">×</span>
                    </div>
                `;
                list.appendChild(item);
            });

            updateGradeDisplay(calculateDayScore(dk));
        }

        function updateGradeDisplay(score) {
            document.querySelectorAll('.grade-circle').forEach(c => c.classList.remove('active'));
            if (score === null) return;
            
            let id = 'g-f';
            if (score >= 100) id = 'g-aplus';
            else if (score >= 80) id = 'g-a';
            else if (score >= 60) id = 'g-b';
            else if (score >= 40) id = 'g-c';
            else if (score >= 20) id = 'g-d';
            
            document.getElementById(id).classList.add('active');
        }

        function toggleHabit(dk, h) {
            if (!trackerData[dk]) trackerData[dk] = {};
            trackerData[dk][h] = !trackerData[dk][h];
            saveData();
            renderDayView();
            renderCalendar();
        }

        function updateNote(val) {
            const dk = formatDateKey(viewDate);
            if (!trackerData[dk]) trackerData[dk] = {};
            trackerData[dk].note = val;
            saveData();
            renderCalendar();
        }

        function addHabit() {
            const val = document.getElementById('new-habit').value.trim();
            if (val) {
                habits.push(val);
                document.getElementById('new-habit').value = '';
                saveData();
                renderDayView();
                renderCalendar();
            }
        }

        function removeHabit(h) {
            habits = habits.filter(item => item !== h);
            saveData();
            renderDayView();
            renderCalendar();
        }

        function changeMonth(offset) {
            calendarDate.setMonth(calendarDate.getMonth() + offset);
            renderCalendar();
        }

        function changeYear(offset) {
            calendarDate.setFullYear(calendarDate.getFullYear() + offset);
            renderCalendar();
        }

        // Init
        renderCalendar();
        renderDayView();
    </script>
</body>
</html>
