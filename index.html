<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rutinkoo — Aesthetic Habit Tracker</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;500;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #1a1b26;
            --surface: #24283b;
            --accent-purple: #bb9af7;
            --accent-teal: #73daca;
            --accent-pink: #f7768e;
            --text-main: #cfc9c2;
            --text-dim: #565f89;
            --border-radius: 24px;
            --soft-shadow: 6px 6px 0px #16161e;
        }

        * { box-sizing: border-box; transition: all 0.2s ease; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- NAVIGATION --- */
        nav {
            background: var(--surface);
            padding: 8px;
            border-radius: 50px;
            display: flex;
            gap: 5px;
            box-shadow: var(--soft-shadow);
            margin-bottom: 40px;
            position: sticky;
            top: 20px;
            z-index: 100;
            border: 2px solid #16161e;
        }

        .nav-btn {
            padding: 10px 20px;
            border-radius: 40px;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            font-weight: 500;
            color: var(--text-dim);
            border: none;
            background: transparent;
        }

        .nav-btn.active { background: var(--accent-purple); color: var(--bg); }

        /* --- HEADER --- */
        header { text-align: center; margin-bottom: 30px; }
        .logo { font-family: 'Fredoka', sans-serif; font-size: 3rem; margin: 0; color: var(--accent-teal); }
        #live-clock { color: var(--text-dim); font-size: 0.9rem; margin-top: 5px; }

        /* --- COMMON UI --- */
        .page { display: none; width: 100%; max-width: 1000px; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .glass-panel {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--soft-shadow);
            border: 2px solid #16161e;
            margin-bottom: 25px;
        }

        h2 { font-family: 'Fredoka', sans-serif; margin-top: 0; color: var(--accent-purple); }

        /* --- CONTROLS --- */
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        input, select, .btn-base {
            background: var(--bg);
            border: 2px solid #16161e;
            color: var(--text-main);
            padding: 10px 15px;
            border-radius: 12px;
            font-family: 'Fredoka', sans-serif;
            outline: none;
        }
        .btn-action { cursor: pointer; background: var(--surface); box-shadow: 3px 3px 0px #16161e; }
        .btn-action:active { transform: translate(1px, 1px); box-shadow: 1px 1px 0px #16161e; }
        .delete-btn { color: var(--accent-pink); padding: 2px 8px; font-size: 0.8rem; cursor: pointer; border-radius: 5px; border: 1px solid var(--accent-pink); margin-left: 5px; }
        .delete-btn:hover { background: var(--accent-pink); color: white; }

        /* --- TABLE --- */
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { color: var(--text-dim); font-weight: 500; padding: 10px; }
        td { background: #2a2f41; padding: 12px; text-align: center; border: 1px solid #333; }
        td:first-child { border-radius: 12px 0 0 12px; border-right: none; }
        td:last-child { border-radius: 0 12px 12px 0; border-left: none; }

        /* Checkbox */
        .habit-check {
            appearance: none; width: 22px; height: 22px; background: var(--bg);
            border-radius: 6px; cursor: pointer; position: relative;
        }
        .habit-check:checked { background: var(--accent-teal); }
        .habit-check:checked::after { content: '✓'; color: var(--bg); position: absolute; left: 5px; top: -2px; font-weight: bold; }

        /* --- ANALYTICS --- */
        .chart-container { height: 300px; width: 100%; margin-top: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--bg); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #16161e; }

        /* --- NOTES --- */
        .reflection-box {
            background: var(--bg);
            border-left: 4px solid var(--accent-pink);
            padding: 15px;
            margin-top: 10px;
            border-radius: 0 12px 12px 0;
            font-style: italic;
            color: var(--accent-purple);
        }
        .note-row { margin-bottom: 20px; border-bottom: 1px dashed #333; padding-bottom: 15px; }
        .summary-tag { font-size: 0.8rem; background: var(--accent-purple); color: var(--bg); padding: 2px 8px; border-radius: 4px; display: inline-block; margin-bottom: 5px; }

    </style>
</head>
<body>

    <header>
        <h1 class="logo">Rutinkoo</h1>
        <div id="live-clock">Loading...</div>
    </header>

    <nav>
        <button class="nav-btn active" onclick="showPage('log')">Goals</button>
        <button class="nav-btn" onclick="showPage('dashboard')">Analytics</button>
        <button class="nav-btn" onclick="showPage('notes')">Notebook</button>
    </nav>

    <!-- PAGE: TRACKER -->
    <div id="log" class="page active">
        <div class="glass-panel">
            <div class="controls">
                <button class="btn-action" onclick="changeDate(-1)">←</button>
                <span id="date-label" style="min-width: 130px; text-align: center; font-family: 'Fredoka';"></span>
                <button class="btn-action" onclick="changeDate(1)">→</button>
                <select id="view-select" onchange="renderTable()">
                    <option value="week">Weekly View</option>
                    <option value="month">Monthly View</option>
                </select>
                <input type="text" id="new-habit-name" placeholder="New soft goal...">
                <button class="btn-action" onclick="addHabit()" style="background: var(--accent-teal); color: var(--bg);">Add</button>
            </div>
            <div style="overflow-x: auto;">
                <table>
                    <thead><tr id="header-row"></tr></thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PAGE: ANALYTICS -->
    <div id="dashboard" class="page">
        <div class="glass-panel">
            <h2>Your Journey</h2>
            <div class="stats-grid" id="stats-container"></div>
            <h3>Habit Fulfillment Trend</h3>
            <div class="chart-container">
                <canvas id="progressChart"></canvas>
            </div>
        </div>
    </div>

    <!-- PAGE: NOTEBOOK -->
    <div id="notes" class="page">
        <div class="glass-panel">
            <h2>Notebook</h2>
            <div id="notes-list"></div>
        </div>
    </div>

    <script>
        let habits = JSON.parse(localStorage.getItem('rutinkoo_habits')) || ['Meditate', 'Read', 'Exercise'];
        let trackerData = JSON.parse(localStorage.getItem('rutinkoo_data')) || {};
        let currentDate = new Date();
        let myChart = null;

        function saveData() {
            localStorage.setItem('rutinkoo_habits', JSON.stringify(habits));
            localStorage.setItem('rutinkoo_data', JSON.stringify(trackerData));
        }

        // --- NAVIGATION & CLOCK ---
        function updateClock() {
            const now = new Date();
            document.getElementById('live-clock').textContent = now.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' }) + " | " + now.toLocaleTimeString();
        }
        setInterval(updateClock, 1000); updateClock();

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
            if(pageId === 'dashboard') initAnalytics();
            if(pageId === 'notes') renderNotesPage();
        }

        // --- GOAL MANAGEMENT ---
        function addHabit() {
            const val = document.getElementById('new-habit-name').value.trim();
            if(val && !habits.includes(val)) {
                habits.push(val);
                document.getElementById('new-habit-name').value = '';
                saveData(); renderTable();
            }
        }

        function removeHabit(habitName) {
            if(confirm(`Remove "${habitName}" from your goals?`)) {
                habits = habits.filter(h => h !== habitName);
                saveData(); renderTable();
            }
        }

        // --- TRACKER TABLE ---
        function formatDateKey(date) { return date.toISOString().split('T')[0]; }

        function renderTable() {
            const view = document.getElementById('view-select').value;
            const start = new Date(currentDate);
            if(view === 'week') start.setDate(start.getDate() - start.getDay() + (start.getDay() === 0 ? -6 : 1));
            else start.setDate(1);

            const days = view === 'week' ? 7 : new Date(start.getFullYear(), start.getMonth() + 1, 0).getDate();
            document.getElementById('date-label').textContent = view === 'week' ? `Week of ${start.getMonth()+1}/${start.getDate()}` : start.toLocaleString('default', { month: 'long' });

            const header = document.getElementById('header-row');
            header.innerHTML = '<th>Date</th>';
            habits.forEach(h => {
                header.innerHTML += `<th>${h} <span class="delete-btn" onclick="removeHabit('${h}')">×</span></th>`;
            });

            const body = document.getElementById('table-body');
            body.innerHTML = '';
            for(let i=0; i<days; i++){
                const d = new Date(start); d.setDate(start.getDate() + i);
                const dk = formatDateKey(d);
                const tr = document.createElement('tr');
                tr.innerHTML = `<td><span style="color:var(--text-dim)">${d.getDate()}</span> <b>${d.toLocaleDateString(undefined, {weekday:'short'})}</b></td>`;
                habits.forEach(h => {
                    const checked = trackerData[dk] && trackerData[dk][h] ? 'checked' : '';
                    const td = document.createElement('td');
                    td.innerHTML = `<input type="checkbox" class="habit-check" ${checked} onchange="toggleHabit('${dk}', '${h}')">`;
                    tr.appendChild(td);
                });
                body.appendChild(tr);
            }
        }

        function toggleHabit(dk, h) {
            if(!trackerData[dk]) trackerData[dk] = {};
            trackerData[dk][h] = !trackerData[dk][h];
            saveData();
        }

        function changeDate(offset) {
            const view = document.getElementById('view-select').value;
            if (view === 'week') currentDate.setDate(currentDate.getDate() + (offset * 7));
            else currentDate.setMonth(currentDate.getMonth() + offset);
            renderTable();
        }

        // --- ANALYTICS & CHART ---
        function initAnalytics() {
            const container = document.getElementById('stats-container');
            container.innerHTML = '';
            
            // Stats cards
            habits.forEach(h => {
                let completed = 0;
                for(let i=0; i<7; i++) {
                    const d = new Date(); d.setDate(d.getDate() - i);
                    if(trackerData[formatDateKey(d)]?.[h]) completed++;
                }
                container.innerHTML += `<div class="stat-card"><b>${h}</b><br><small>${completed}/7 Days</small></div>`;
            });

            // Line Chart Data (Last 10 days)
            const labels = [];
            const dataPoints = [];
            for(let i=9; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const dk = formatDateKey(d);
                labels.push(d.toLocaleDateString(undefined, {month:'short', day:'numeric'}));
                
                let count = 0;
                if(trackerData[dk]) {
                    habits.forEach(h => { if(trackerData[dk][h]) count++; });
                }
                dataPoints.push(count);
            }

            if(myChart) myChart.destroy();
            const ctx = document.getElementById('progressChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Tasks Completed',
                        data: dataPoints,
                        borderColor: '#73daca',
                        backgroundColor: 'rgba(115, 218, 202, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#bb9af7'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: habits.length + 1, grid: { color: '#2a2f41' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        // --- NOTEBOOK & EARLY SENTENCE LOGIC ---
        function renderNotesPage() {
            const list = document.getElementById('notes-list');
            list.innerHTML = '';
            const today = new Date();
            for(let i=0; i<7; i++) {
                const d = new Date(); d.setDate(today.getDate() - i);
                const dk = formatDateKey(d);
                const val = trackerData[dk]?.note || '';
                
                // Early Sentence Extraction
                const earlySentence = val ? val.split(/[.!?]/)[0] + (val.length > 0 ? "..." : "") : "No reflections yet.";

                const row = document.createElement('div');
                row.className = 'note-row';
                row.innerHTML = `
                    <div style="font-weight:bold; margin-bottom:10px;">${d.toLocaleDateString(undefined, {month:'long', day:'numeric'})}</div>
                    <div class="summary-tag">Snapshot</div>
                    <div class="reflection-box">"${earlySentence}"</div>
                    <input type="text" class="btn-base" style="width:100%; margin-top:10px; background:var(--surface)" 
                           value="${val}" placeholder="Write tonight's reflection..." 
                           onchange="updateNote('${dk}', this.value)">
                `;
                list.appendChild(row);
            }
        }

        function updateNote(dk, val) {
            if(!trackerData[dk]) trackerData[dk] = {};
            trackerData[dk].note = val;
            saveData();
            renderNotesPage(); // Refresh to update "Early Sentence"
        }

        renderTable();
    </script>
</body>
</html>
